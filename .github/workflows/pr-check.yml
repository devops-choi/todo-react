name: ğŸ” Pull Request Check

on:
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  code-quality:
    name: ğŸ§¹ Code Quality Check
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: âš™ï¸ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: npm ci
      
    - name: ğŸ” Run ESLint
      run: |
        echo "ğŸ” Running ESLint..."
        npx eslint src/ --ext .js,.jsx,.ts,.tsx --format=compact || true
        
    - name: ğŸ¨ Check code formatting
      run: |
        echo "ğŸ¨ Checking code formatting..."
        npx prettier --check src/ || echo "âš ï¸ Some files need formatting"
        
    - name: ğŸ§ª Run tests with coverage
      run: |
        echo "ğŸ§ª Running tests..."
        npm test -- --coverage --watchAll=false --passWithNoTests
        
    - name: ğŸ—ï¸ Test build
      run: |
        echo "ğŸ—ï¸ Testing build process..."
        npm run build
        
    - name: ğŸ“Š Bundle size analysis
      run: |
        echo "ğŸ“Š Analyzing bundle size..."
        du -sh build/static/js/* || echo "No JS files found"
        du -sh build/static/css/* || echo "No CSS files found"
        
    - name: ğŸ”’ Security audit
      run: |
        echo "ğŸ”’ Running security audit..."
        npm audit --audit-level=moderate || echo "âš ï¸ Security vulnerabilities found"
        
    - name: ğŸ“‹ PR Summary
      run: |
        echo "## ğŸ¯ Pull Request Analysis Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### âœ… Completed Checks:" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ” Code linting (ESLint)" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ¨ Code formatting (Prettier)" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ§ª Unit tests with coverage" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ—ï¸ Build verification" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ“Š Bundle size analysis" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ”’ Security audit" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ“ˆ Next Steps:" >> $GITHUB_STEP_SUMMARY
        echo "If all checks pass, this PR is ready for review and merge." >> $GITHUB_STEP_SUMMARY

  dependency-review:
    name: ğŸ” Dependency Review
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ” Dependency Review
      uses: actions/dependency-review-action@v4
      with:
        fail-on-severity: moderate
        allow-licenses: MIT, Apache-2.0, BSD-2-Clause, BSD-3-Clause, ISC
